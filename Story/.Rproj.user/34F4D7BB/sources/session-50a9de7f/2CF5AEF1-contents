---
title: "The Donut Effect: Hollowing Downtowns in the Bay Area"
subtitle: "MUSA 508, Assignment 2"
author: "Samriddhi Khare, University of Pennsylvania"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
    code_download: true
    theme: cerulean 
---

# San Fran infra chanfes

https://siepr.stanford.edu/publications/policy-brief/donut-effect-how-covid-19-shapes-real-estate#:~:text=But%20what%20is%20driving%20the,work%20from%20home%20(WFH).


The Central Subway T Third Line in San Francisco is a pivotal addition to the city's public transportation network, representing a crucial extension of the Muni Metro system. This underground light rail line, officially known as the T Third Street line, connects the southeastern neighborhoods of Bayview-Hunters Point and Visitacion Valley to the city's downtown area. Serving as a vital link for residents and commuters, the Central Subway enhances accessibility, reduces travel times, and fosters connectivity in a historically underserved region. With its integration into the broader Muni Metro system, the T Third Line plays a key role in supporting the city's commitment to sustainable and efficient public transportation options.

The Central Subway T Third Line in San Francisco connects various neighborhoods, serving as a crucial link between different areas of the city. Specifically, it connects:

Bayview-Hunters Point:

The T Third Line starts in the southeastern neighborhood of Bayview-Hunters Point, an area historically underserved by public transportation.
Visitacion Valley:

The line extends through Visitacion Valley, another neighborhood in the southeastern part of San Francisco.
South of Market (SoMa):

As the T Third Line progresses northward, it serves the South of Market (SoMa) district, a dynamic and rapidly developing area with a mix of residential and commercial spaces.
Downtown San Francisco:

The line continues into the heart of downtown San Francisco, connecting to the existing Muni Metro system and providing access to various business, cultural, and entertainment districts.
By connecting these diverse neighborhoods, the T Third Line contributes to improved accessibility, efficient commuting, and enhanced connectivity for residents and visitors alike. The extension of the Muni Metro system via the Central Subway plays a significant role in fostering a more integrated and accessible public transportation network throughout the city.

```{r setup, include=FALSE}
  knitr::opts_chunk$set(
    echo = TRUE,
    warning = FALSE,
    message = FALSE,
    out.width = '100%',
    fig.retina =3
  )
```

## R Markdown

```{r packages}
library(tidyverse)
library(tidycensus)
library(sf)
library(tidyr)
library(ggplot2)
library(viridis)
library(stringr)
library(mapview)
library(tigris)
library(ggplot2)
library(dplyr)
library(ggbeeswarm)
library(scales)
library(ggiraph)
library(plotly)
```

```{r echo=FALSE, results='hide'}
bay = c("San Francisco", "Alameda", "Contra Costa", "Marin", "Napa", "San Mateo", "Santa Clara", "Solano", "Sonoma")

san_francisco <- get_acs(
  geography = "tract",
  variables = "B19013_001", #median income
  year = 2021,
  state = "CA",
  county = bay ,
  geometry = TRUE
)

```

```{r}
mapview(san_francisco, zcol = "estimate")
```


```{r eval=FALSE, include=FALSE}
# Assuming 'bay' is defined somewhere in your code
vt_income <- get_acs(
  geography = "county",
  variables = "B19013_001",
  state = "CA",
  county = bay,
  year = 2020,
  geometry = TRUE
) %>%
  mutate(NAME = str_remove(NAME, " County, California"))

# Choropleth map
vt_map <- ggplot(vt_income, aes(fill = estimate)) + 
   #geom_sf(aes(color = "white"), size = 0.5) +
  geom_sf_interactive(aes(data_id = GEOID)) + 
  scale_fill_viridis_c() +  # Use viridis palette
  theme_void()+
  guides(fill = "none") 

# Scatter plot with error bars
vt_plot <- ggplot(vt_income, aes(x = estimate, y = reorder(NAME, estimate), 
                                 fill = estimate)) +
  geom_errorbar(aes(xmin = estimate - moe, xmax = estimate + moe)) +
  geom_point_interactive(color = "black", size = 4, shape = 21,
                         aes(data_id = GEOID)) +
  scale_fill_viridis_c() +  # Use viridis palette
  scale_x_continuous(labels = scales::dollar_format()) + 
  labs(title = "Household income by county in the Bay Area",
       subtitle = "2016-2020 American Community Survey",
       y = "",
       x = "Median Income (bars represent margin of error)",
       fill = "Median Income") + 
  theme_minimal(base_size = 14)

# Combine the maps
girafe(ggobj = vt_map + vt_plot, width_svg = 12, height_svg = 5) %>%
  girafe_options(opts_hover(css = "fill:cyan;"))
```



